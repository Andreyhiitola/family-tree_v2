<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ–∞–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –¥—Ä–µ–≤–æ —Å–µ–º—å–∏</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üå≥ –ì–µ–Ω–µ–∞–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –¥—Ä–µ–≤–æ —Å–µ–º—å–∏</h1>
            <p class="subtitle">–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—à–µ–π —Å–µ–º—å–∏ –≤ –ª–∏—Ü–∞—Ö</p>
        </header>

        <div class="controls">
            <button class="btn btn-primary" onclick="showAddPersonModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
            <button class="btn" onclick="showGallery()">üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è</button>
            <button class="btn" onclick="showTimeline()">üìÖ –°–æ–±—ã—Ç–∏—è</button>
            <button class="btn" onclick="showStats()">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="btn" onclick="showMap()">üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>
            <button class="btn" onclick="toggleTheme()">üåô –¢–µ–º–∞</button>
            <button class="btn" onclick="exportToPDF()">üìÑ PDF</button>
            <button class="btn" onclick="exportData()">üíæ JSON</button>
            <button class="btn" onclick="exportToExcel()">üìä Excel</button>
            <button class="btn" onclick="importData()">üì• –ò–º–ø–æ—Ä—Ç JSON</button>
            <button class="btn" onclick="importExcel()">üìä –ò–º–ø–æ—Ä—Ç Excel</button>
            <button class="btn" onclick="downloadTemplate()">üìù –®–∞–±–ª–æ–Ω Excel</button>
        </div>

        <div class="search-container">
            <input type="text" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏..." onkeyup="searchPerson()">
            <button class="btn-clear" onclick="clearSearch()" style="display:none;">‚úï</button>
        </div>

        <div class="tree-container">
            <div class="tree" id="familyTree"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
    <div id="viewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="viewModalName"></h2>
                <span class="close" onclick="closeModal('viewModal')">&times;</span>
            </div>
            
            <div class="photo-carousel" id="photoCarousel">
                <button class="carousel-btn prev" onclick="prevPhoto()">&lt;</button>
                <img id="viewModalPhoto" class="modal-photo" src="" alt="">
                <button class="carousel-btn next" onclick="nextPhoto()">&gt;</button>
            </div>
            
            <div class="modal-info" id="viewModalInfo"></div>
            
            <div class="media-section" id="mediaSection"></div>
            
            <div class="btn-group">
                <button class="btn-save" onclick="editCurrentPerson()">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div id="editModal" class="modal">
        <div class="modal-content modal-wide">
            <div class="modal-header">
                <h2 id="editModalTitle">–î–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞</h2>
                <span class="close" onclick="closeModal('editModal')">&times;</span>
            </div>
            
            <form id="personForm">
                <div class="form-group">
                    <label>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</label>
                    <div class="photo-upload-multi">
                        <div class="photos-preview" id="photosPreview">
                            <div class="add-photo-btn" onclick="document.getElementById('photoInput').click()">
                                <span>‚ûï</span>
                                <p>–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</p>
                            </div>
                        </div>
                        <input type="file" id="photoInput" accept="image/*" multiple style="display:none;">
                    </div>
                </div>

                <div class="form-group">
                    <label>–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è *</label>
                    <input type="text" id="personName" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                        <input type="date" id="personBirthDate">
                    </div>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ —Å–º–µ—Ä—Ç–∏</label>
                        <input type="date" id="personDeathDate">
                    </div>
                </div>

                <div class="form-group">
                    <label>–ü–æ–ª</label>
                    <select id="personGender">
                        <option value="">–ù–µ —É–∫–∞–∑–∞–Ω</option>
                        <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                        <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>–†–æ–¥–∏—Ç–µ–ª—å 1 (–º–∞—Ç—å/–æ—Ç–µ—Ü)</label>
                        <select id="personParent1">
                            <option value="">–ù–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–†–æ–¥–∏—Ç–µ–ª—å 2 (–º–∞—Ç—å/–æ—Ç–µ—Ü)</label>
                        <select id="personParent2">
                            <option value="">–ù–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>–°—É–ø—Ä—É–≥–∏/–ø–∞—Ä—Ç–Ω—ë—Ä—ã</label>
                    <div class="spouses-container">
                        <div id="spousesList"></div>
                        <select id="personSpouse">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–ø—Ä—É–≥–∞...</option>
                        </select>
                        <button type="button" class="btn-add-spouse" onclick="addSpouse()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—É–ø—Ä—É–≥–∞</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>–ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                    <input type="text" id="personBirthPlace" placeholder="–ì–æ—Ä–æ–¥, —Å—Ç—Ä–∞–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ú–æ—Å–∫–≤–∞, –†–æ—Å—Å–∏—è)">
                    <small style="color: var(--text-secondary); font-size: 0.85em;">
                        –ë—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∞ –∫–∞—Ä—Ç–µ. –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: "55.7558, 37.6173"
                    </small>
                </div>

                <div class="form-group">
                    <label>–û —á–µ–ª–æ–≤–µ–∫–µ</label>
                    <textarea id="personBio" placeholder="–ü—Ä–æ—Ñ–µ—Å—Å–∏—è, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã..."></textarea>
                </div>

                <div class="form-group">
                    <label>–í–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–æ–¥–Ω–æ –Ω–∞ —Å—Ç—Ä–æ–∫—É)</label>
                    <textarea id="personEvents" placeholder="1990 - –û–∫–æ–Ω—á–∏–ª —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç&#10;2000 - –ü–µ—Ä–µ–µ—Ö–∞–ª –≤ –ú–æ—Å–∫–≤—É&#10;2010 - –û—Å–Ω–æ–≤–∞–ª –∫–æ–º–ø–∞–Ω–∏—é"></textarea>
                </div>

                <div class="form-group">
                    <label>–í–∏–¥–µ–æ URL (YouTube, Vimeo)</label>
                    <input type="url" id="personVideo" placeholder="https://youtube.com/watch?v=...">
                </div>

                <div class="form-group">
                    <label>–ê—É–¥–∏–æ –∑–∞–º–µ—Ç–∫–∞</label>
                    <div class="audio-controls">
                        <button type="button" class="btn-record" id="recordBtn" onclick="toggleRecording()">üé§ –ó–∞–ø–∏—Å–∞—Ç—å</button>
                        <audio id="audioPreview" controls style="display:none;"></audio>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn-cancel" onclick="closeModal('editModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn-delete" id="deleteBtn" onclick="deletePerson()" style="display:none;">–£–¥–∞–ª–∏—Ç—å</button>
                    <button type="submit" class="btn-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≥–∞–ª–µ—Ä–µ–∏ -->
    <div id="galleryModal" class="modal">
        <div class="modal-content modal-wide">
            <div class="modal-header">
                <h2>üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</h2>
                <span class="close" onclick="closeModal('galleryModal')">&times;</span>
            </div>
            <div class="gallery-grid" id="galleryGrid"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div id="statsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥—Ä–µ–≤–∞</h2>
                <span class="close" onclick="closeModal('statsModal')">&times;</span>
            </div>
            <div class="stats-content" id="statsContent"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —à–∫–∞–ª—ã -->
    <div id="timelineModal" class="modal">
        <div class="modal-content modal-wide">
            <div class="modal-header">
                <h2>üìÖ –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ —Å–æ–±—ã—Ç–∏–π</h2>
                <span class="close" onclick="closeModal('timelineModal')">&times;</span>
            </div>
            <div class="timeline-content" id="timelineContent"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Ä—Ç—ã -->
    <div id="mapModal" class="modal">
        <div class="modal-content modal-wide">
            <div class="modal-header">
                <h2>üó∫Ô∏è –ö–∞—Ä—Ç–∞ –º–µ—Å—Ç —Ä–æ–∂–¥–µ–Ω–∏—è</h2>
                <span class="close" onclick="closeModal('mapModal')">&times;</span>
            </div>
            <div class="map-toggle">
                <button id="showMapBtn" class="active" onclick="toggleMapView('map')">üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>
                <button id="showListBtn" onclick="toggleMapView('list')">üìã –°–ø–∏—Å–æ–∫</button>
            </div>
            <div class="map-content" id="mapContent">
                <div id="map"></div>
            </div>
            <div class="map-content" id="listContent" style="display:none;">
                <div class="map-list" id="mapList"></div>
            </div>
        </div>
    </div>

    <input type="file" id="importInput" accept=".json" style="display:none;">
    <input type="file" id="excelInput" accept=".xlsx,.xls,.csv" style="display:none;">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
